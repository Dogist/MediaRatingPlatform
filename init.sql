DROP TABLE IF EXISTS USER_ACC CASCADE;
DROP TABLE IF EXISTS MEDIA_ENTRY CASCADE;

CREATE TABLE IF NOT EXISTS USER_ACC
(
    USER_ID        BIGINT GENERATED BY DEFAULT AS IDENTITY,
    USERNAME       VARCHAR NOT NULL UNIQUE,
    PASSWORD       VARCHAR NOT NULL,
    EMAIL          VARCHAR,
    FAVORITE_GENRE VARCHAR,

    PRIMARY KEY (USER_ID)
);

CREATE TABLE IF NOT EXISTS MEDIA_ENTRY
(
    MEDIA_ENTRY_ID BIGINT  NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    TYPE           VARCHAR NOT NULL,
    TITLE          VARCHAR NOT NULL,
    DESCRIPTION    VARCHAR NOT NULL,
    RELEASE_YEAR   INT     NOT NULL,
    MIN_AGE        INT     NOT NULL,

    CREATOR        BIGINT REFERENCES USER_ACC (USER_ID),

    PRIMARY KEY (MEDIA_ENTRY_ID)
);
CREATE TABLE IF NOT EXISTS MEDIA_ENTRY_GENRES
(
    MEDIA_ENTRY_ID BIGINT  NOT NULL REFERENCES MEDIA_ENTRY (MEDIA_ENTRY_ID),
    GENRE          VARCHAR NOT NULL,

    PRIMARY KEY (GENRE, MEDIA_ENTRY_ID)
);

CREATE TABLE IF NOT EXISTS RATING
(
    RATING_ID      BIGINT GENERATED BY DEFAULT AS IDENTITY,
    USER_ID        BIGINT     NOT NULL REFERENCES USER_ACC (USER_ID),
    MEDIA_ENTRY_ID BIGINT     NOT NULL REFERENCES MEDIA_ENTRY (MEDIA_ENTRY_ID),

    RATING         NUMERIC(1) NOT NULL,
    COMMENT        VARCHAR(2000),
    TIMESTAMP      TIMESTAMP DEFAULT NOW(),
    CONFIRMED      BOOLEAN    NOT NULL,

    PRIMARY KEY (RATING_ID)
);

CREATE TABLE IF NOT EXISTS USER_MEDIA
(
    USER_ID        BIGINT  NOT NULL REFERENCES USER_ACC (USER_ID),
    MEDIA_ENTRY_ID BIGINT  NOT NULL REFERENCES MEDIA_ENTRY (MEDIA_ENTRY_ID),

    FAVOURITE      BOOLEAN NOT NULL,

    PRIMARY KEY (USER_ID, MEDIA_ENTRY_ID)
);

CREATE TABLE IF NOT EXISTS USER_LIKE_RATING
(
    USER_ID   BIGINT NOT NULL REFERENCES USER_ACC (USER_ID),
    RATING_ID BIGINT NOT NULL REFERENCES RATING (RATING_ID),

    PRIMARY KEY (USER_ID, RATING_ID)
)


