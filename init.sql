DROP TABLE IF EXISTS USER_ACC CASCADE;
DROP TABLE IF EXISTS MEDIA_ENTRY CASCADE;
DROP TABLE IF EXISTS RATING CASCADE;
DROP TABLE IF EXISTS USER_FAVORITE_MEDIA CASCADE;
DROP TABLE IF EXISTS USER_LIKE_RATING CASCADE;

CREATE TABLE IF NOT EXISTS USER_ACC
(
    USER_ID        BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    USERNAME       VARCHAR NOT NULL UNIQUE,
    PASSWORD       VARCHAR NOT NULL,
    EMAIL          VARCHAR,
    FAVORITE_GENRE VARCHAR
);

CREATE TABLE IF NOT EXISTS MEDIA_ENTRY
(
    MEDIA_ENTRY_ID  BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    MEDIA_TYPE      VARCHAR NOT NULL,
    TITLE           VARCHAR NOT NULL,
    DESCRIPTION     VARCHAR NOT NULL,
    RELEASE_YEAR    INT     NOT NULL,
    AGE_RESTRICTION INT     NOT NULL,
    GENRES          TEXT[],
    CREATOR         BIGINT REFERENCES USER_ACC (USER_ID)
);

CREATE TABLE IF NOT EXISTS RATING
(
    RATING_ID      BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    USER_ID        BIGINT     NOT NULL REFERENCES USER_ACC (USER_ID) ON DELETE CASCADE,
    MEDIA_ENTRY_ID BIGINT     NOT NULL REFERENCES MEDIA_ENTRY (MEDIA_ENTRY_ID) ON DELETE CASCADE,

    RATING         NUMERIC(1) NOT NULL,
    COMMENT        VARCHAR(2000),
    TIMESTAMP      TIMESTAMP DEFAULT NOW(),
    CONFIRMED      BOOLEAN    NOT NULL
);

CREATE TABLE IF NOT EXISTS USER_FAVORITE_MEDIA
(
    USER_ID        BIGINT NOT NULL REFERENCES USER_ACC (USER_ID),
    MEDIA_ENTRY_ID BIGINT NOT NULL REFERENCES MEDIA_ENTRY (MEDIA_ENTRY_ID),

    PRIMARY KEY (USER_ID, MEDIA_ENTRY_ID)
);

CREATE TABLE IF NOT EXISTS USER_LIKE_RATING
(
    USER_ID   BIGINT NOT NULL REFERENCES USER_ACC (USER_ID) ON DELETE CASCADE,
    RATING_ID BIGINT NOT NULL REFERENCES RATING (RATING_ID) ON DELETE CASCADE,

    PRIMARY KEY (USER_ID, RATING_ID)
)


